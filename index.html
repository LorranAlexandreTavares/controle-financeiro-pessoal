<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Controle Financeiro Avan√ßado</title>
<style>
/* Estilos b√°sicos (mantidos e ligeiramente ajustados) */
body { margin: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f0f2f5; }
.app { display: flex; min-height: 100vh; }
.menu { width: 250px; background: #1f2937; color: white; padding: 20px; box-shadow: 2px 0 5px rgba(0,0,0,0.1); }
.menu h2 { margin-top: 0; border-bottom: 1px solid #374151; padding-bottom: 15px; margin-bottom: 20px; }
.menu button { width: 100%; background: none; border: none; color: white; text-align: left; padding: 15px; cursor: pointer; border-radius: 6px; margin-bottom: 5px; transition: background 0.3s; font-size: 16px; }
.menu button:hover, .menu button.active { background: #374151; }
.content { flex: 1; padding: 30px; }
.card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,.08); margin-bottom: 25px; }
input, button, select { padding: 12px; margin-top: 10px; border-radius: 6px; border: 1px solid #ccc; box-sizing: border-box; }
input, select { width: 100%; }
button.primary { background: #10b981; color: white; border: none; cursor: pointer; transition: background 0.3s; }
button.primary:hover { background: #059669; }
.verde { background: #16a34a; color: white; padding: 15px; border-radius: 6px; text-align: center; }
.vermelho { background: #ef4444; color: white; padding: 15px; border-radius: 6px; text-align: center; }
.saldo-card { display: flex; justify-content: space-around; text-align: center; gap: 20px; }
.saldo-item { flex: 1; padding: 15px; border-radius: 8px; font-weight: bold; }
.saldo-item.entrada { background-color: #d1fae5; color: #065f46; }
.saldo-item.saida { background-color: #fee2e2; color: #991b1b; }
.meta-progresso { height: 10px; background-color: #e5e7eb; border-radius: 5px; margin-top: 10px; }
.meta-progresso-bar { height: 100%; background-color: #3b82f6; border-radius: 5px; transition: width 0.5s; }
.historico-mes { border-left: 3px solid #6366f1; padding-left: 15px; margin-bottom: 20px; }
.transacao { border-bottom: 1px dashed #e5e7eb; padding: 8px 0; display: flex; justify-content: space-between; font-size: 0.9em; }
</style>
</head>

<body>

<div id="cadastro" class="content">
    <div class="card">
        <h1>Primeiro Acesso</h1>
        <input id="nome" placeholder="Seu Nome">
        <input id="metaEconomia" type="number" placeholder="Meta de Economia Mensal (R$)">
        <button class="primary" onclick="salvarUsuario()">Iniciar Controle</button>
    </div>
</div>

<div id="app" class="app" style="display:none">

    <div class="menu">
        <h2>üìä Financeiro</h2>
        <button id="btn-inicio" onclick="mostrar('inicio')">In√≠cio</button>
        <button id="btn-entradas" onclick="mostrar('entradas')">Adicionar Entrada</button>
        <button id="btn-saidas" onclick="mostrar('saidas')">Adicionar Sa√≠da</button>
        <button id="btn-metas" onclick="mostrar('metas')">Metas e Objetivos</button>
        <button id="btn-historico" onclick="mostrar('historico')">Hist√≥rico Mensal</button>
        <button id="btn-graficos" onclick="mostrar('graficos')">Gr√°ficos de Desempenho</button>
    </div>

    <div class="content">
        <div id="inicio" class="pagina card"></div>
        <div id="entradas" class="pagina card" style="display:none"></div>
        <div id="saidas" class="pagina card" style="display:none"></div>
        <div id="metas" class="pagina card" style="display:none"></div>
        <div id="historico" class="pagina card" style="display:none"></div>
        <div id="graficos" class="pagina card" style="display:none"></div>
    </div>

</div>

<script>
// Vari√°vel global para armazenar os dados do app
let dados;
const STORAGE_KEY = "appFinanceiroPro";
const PAGINAS = ['inicio', 'entradas', 'saidas', 'metas', 'historico', 'graficos'];

// --- FUN√á√ïES DE DADOS E ARMAZENAMENTO ---

function carregarDados() {
    const storage = localStorage.getItem(STORAGE_KEY);
    if (storage) {
        dados = JSON.parse(storage);
    } else {
        // Estrutura inicial, caso n√£o haja dados
        dados = {
            usuario: { nome: "", metaEconomia: 0 },
            transacoes: [], // Transa√ß√µes unificadas (Entrada/Sa√≠da)
            metas: []
        };
    }
}

function salvarDados() {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(dados));
}

function salvarUsuario() {
    dados = {
        usuario: {
            nome: nome.value || "Usu√°rio",
            metaEconomia: Number(metaEconomia.value) || 0
        },
        transacoes: [],
        metas: []
    };
    salvarDados();
    iniciarApp();
}

function adicionarTransacao(tipo) { // tipo: 'entrada' ou 'saida'
    const valorInput = document.getElementById(`valor${tipo}`);
    const descricaoInput = document.getElementById(`descricao${tipo}`);

    if (valorInput.value && descricaoInput.value) {
        dados.transacoes.push({
            tipo: tipo,
            valor: Number(valorInput.value),
            descricao: descricaoInput.value,
            data: new Date().toISOString()
        });
        salvarDados();
        mostrar("inicio"); // Volta para o In√≠cio ap√≥s adicionar
    } else {
        alert("Preencha todos os campos!");
    }
}

// --- FUN√á√ïES DE C√ÅLCULO GERAL ---

function calcularTotais(transacoes) {
    const totalE = transacoes.filter(t => t.tipo === 'entrada').reduce((s, t) => s + t.valor, 0);
    const totalS = transacoes.filter(t => t.tipo === 'saida').reduce((s, t) => s + t.valor, 0);
    const saldo = totalE - totalS;
    return { totalE, totalS, saldo };
}

function calcularDesempenhoMensal() {
    const hoje = new Date();
    const mesAtual = hoje.getMonth();
    const anoAtual = hoje.getFullYear();

    const transacoesMes = dados.transacoes.filter(t => {
        const data = new Date(t.data);
        return data.getMonth() === mesAtual && data.getFullYear() === anoAtual;
    });

    const { totalE, totalS, saldo } = calcularTotais(transacoesMes);

    const restante = saldo - dados.usuario.metaEconomia;

    return { totalE, totalS, saldo, restante };
}


// --- FUN√á√ïES DE NAVEGA√á√ÉO E IN√çCIO ---

function iniciarApp() {
    carregarDados();
    if (dados.usuario.nome) {
        document.getElementById('cadastro').style.display = "none";
        document.getElementById('app').style.display = "flex";
        mostrar("inicio");
    }
}

function mostrar(pagina) {
    // Esconde todas as p√°ginas e remove a classe 'active'
    PAGINAS.forEach(p => {
        document.getElementById(p).style.display = "none";
        document.getElementById(`btn-${p}`).classList.remove('active');
    });

    // Mostra a p√°gina solicitada e marca o bot√£o como 'active'
    document.getElementById(pagina).style.display = "block";
    document.getElementById(`btn-${pagina}`).classList.add('active');

    // Renderiza o conte√∫do da p√°gina
    if (pagina === "inicio") renderInicio();
    if (pagina === "entradas") renderEntradas();
    if (pagina === "saidas") renderSaidas();
    if (pagina === "metas") renderMetas();
    if (pagina === "historico") renderHistorico();
    if (pagina === "graficos") renderGraficos();
}


// --- FUN√á√ïES DE RENDERIZA√á√ÉO (VISUALIZA√á√ÉO) ---

function renderInicio() {
    const { totalE, totalS, saldo, restante } = calcularDesempenhoMensal();

    inicio.innerHTML = `
        <h2>Ol√°, ${dados.usuario.nome}! </h2>
        <h3>Desempenho Mensal (M√™s Atual)</h3>
        
        <div class="saldo-card">
            <div class="saldo-item entrada">
                <span>Total Entradas</span>
                <p>R$ ${totalE.toFixed(2)}</p>
            </div>
            <div class="saldo-item saida">
                <span>Total Sa√≠das</span>
                <p>R$ ${totalS.toFixed(2)}</p>
            </div>
        </div>
        
        <div class="card" style="margin-top:20px;">
            <h3>Saldo Atual: R$ ${saldo.toFixed(2)}</h3>
        </div>

        <div class="${restante >= 0 ? 'verde' : 'vermelho'} card">
            <h4>Meta de Economia: R$ ${dados.usuario.metaEconomia.toFixed(2)}</h4>
            ${restante >= 0
                ? `<p>Parab√©ns! Voc√™ economizou R$ ${restante.toFixed(2)} acima da meta!</p>`
                : `<p>Aten√ß√£o! Voc√™ precisa economizar mais R$ ${Math.abs(restante).toFixed(2)} para atingir a meta.</p>`}
        </div>
    `;
}

function renderEntradas() {
    entradas.innerHTML = `
        <h2>‚ûï Adicionar Nova Entrada</h2>
        <input id="descricaoentrada" placeholder="Descri√ß√£o (Ex: Sal√°rio, Freelance)">
        <input id="valorentrada" type="number" placeholder="Valor da Entrada (R$)">
        <button class="primary" onclick="adicionarTransacao('entrada')">Registrar Entrada</button>
    `;
}

function renderSaidas() {
    saidas.innerHTML = `
        <h2>‚ûñ Adicionar Nova Sa√≠da</h2>
        <input id="descricaosaida" placeholder="Descri√ß√£o (Ex: Aluguel, Supermercado)">
        <input id="valorsaida" type="number" placeholder="Valor da Sa√≠da (R$)">
        <button class="primary" onclick="adicionarTransacao('saida')">Registrar Sa√≠da</button>
    `;
}

function renderMetas() {
    metas.innerHTML = `
        <h2>üéØ Metas de Longo Prazo</h2>
        <div class="card">
            <h3>Criar Nova Meta</h3>
            <input id="nomeMeta" placeholder="Nome da meta (Ex: Carro Novo)">
            <input id="valorTotalMeta" type="number" placeholder="Valor Total Necess√°rio (R$)">
            <input id="valorAtualMeta" type="number" placeholder="Valor J√° Acumulado (R$)">
            <input id="valorAlocadoMeta" type="number" placeholder="Valor Alocado neste M√™s (R$)">
            <input id="dataMeta" type="date" title="Prazo Final">
            <button class="primary" onclick="criarMeta()">Salvar Meta</button>
        </div>
        <hr style="border: 0; border-top: 1px dashed #ccc; margin: 30px 0;">
        <h3>Minhas Metas Atuais</h3>
    `;

    if (dados.metas.length === 0) {
        metas.innerHTML += "<p>Nenhuma meta registrada ainda.</p>";
        return;
    }

    dados.metas.forEach((m, i) => {
        const perc = ((m.atual / m.total) * 100).toFixed(1);
        const diff = new Date(m.data) - new Date();
        const dias = Math.max(Math.floor(diff / (1000 * 60 * 60 * 24)), 0);
        
        metas.innerHTML += `
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <h3>${m.nome}</h3>
                    <button style="width: auto; padding: 5px 10px;" onclick="deletarMeta(${i})">X</button>
                </div>
                <p>Valor Total: R$ ${m.total.toFixed(2)} | Acumulado: R$ ${m.atual.toFixed(2)}</p>
                <p>Alocado este M√™s: R$ ${m.alocado.toFixed(2)}</p>
                
                <div class="meta-progresso">
                    <div class="meta-progresso-bar" style="width: ${Math.min(perc, 100)}%;"></div>
                </div>
                <small>Progresso: ${perc}% | Falta R$ ${(m.total - m.atual).toFixed(2)} | ${dias} dias restantes.</small>
                
                <input type="number" placeholder="Adicionar valor extra"
                    onkeydown="if(event.key==='Enter') adicionarValorMeta(${i},this.value)">
            </div>
        `;
    });
}

function criarMeta() {
    dados.metas.push({
        nome: nomeMeta.value,
        total: Number(valorTotalMeta.value),
        atual: Number(valorAtualMeta.value) || 0,
        alocado: Number(valorAlocadoMeta.value) || 0,
        data: dataMeta.value
    });
    salvarDados();
    mostrar("metas");
}

function adicionarValorMeta(i, valor) {
    const numValor = Number(valor);
    if (numValor > 0) {
        dados.metas[i].atual += numValor;
        salvarDados();
        mostrar("metas");
    }
}

function deletarMeta(i) {
    if(confirm("Tem certeza que deseja deletar esta meta?")) {
        dados.metas.splice(i, 1);
        salvarDados();
        mostrar("metas");
    }
}


function renderHistorico() {
    historico.innerHTML = `<h2>üìÖ Hist√≥rico de Transa√ß√µes por M√™s</h2>`;

    if (dados.transacoes.length === 0) {
        historico.innerHTML += "<p>Nenhuma transa√ß√£o registrada ainda.</p>";
        return;
    }

    // 1. Agrupar transa√ß√µes por M√™s/Ano
    const historicoAgrupado = dados.transacoes.reduce((acc, t) => {
        const data = new Date(t.data);
        const mesAno = `${data.getFullYear()}-${(data.getMonth() + 1).toString().padStart(2, '0')}`;
        const mesNome = data.toLocaleDateString('pt-BR', { month: 'long', year: 'numeric' });

        if (!acc[mesAno]) {
            acc[mesAno] = { nome: mesNome, transacoes: [] };
        }
        acc[mesAno].transacoes.push(t);
        return acc;
    }, {});

    // 2. Renderizar os grupos (do mais recente para o mais antigo)
    Object.keys(historicoAgrupado).sort().reverse().forEach(mesAno => {
        const grupo = historicoAgrupado[mesAno];
        const { totalE, totalS, saldo } = calcularTotais(grupo.transacoes);

        historico.innerHTML += `
            <div class="historico-mes card">
                <h3>${grupo.nome}</h3>
                <p>Entradas: R$ ${totalE.toFixed(2)} | Sa√≠das: R$ ${totalS.toFixed(2)} | Saldo Final: <strong style="color:${saldo >= 0 ? '#10b981' : '#ef4444'}">R$ ${saldo.toFixed(2)}</strong></p>
                
                <details>
                    <summary>Ver ${grupo.transacoes.length} Detalhes</summary>
                    <div style="margin-top: 10px;">
                        ${grupo.transacoes.map(t => {
                            const cor = t.tipo === 'entrada' ? '#065f46' : '#991b1b';
                            const sinal = t.tipo === 'entrada' ? '+' : '-';
                            const dataFormatada = new Date(t.data).toLocaleDateString('pt-BR');
                            return `<div class="transacao">
                                <span>${dataFormatada} - ${t.descricao}</span>
                                <span style="color:${cor};">${sinal} R$ ${t.valor.toFixed(2)}</span>
                            </div>`;
                        }).join('')}
                    </div>
                </details>
            </div>
        `;
    });
}

function renderGraficos() {
    graficos.innerHTML = `
        <h2>üìà Gr√°ficos de Desempenho</h2>
        <p>Esta se√ß√£o foi preparada para gr√°ficos. Voc√™ pode integrar bibliotecas como Chart.js ou D3.js aqui.</p>
        
        <div class="card">
            <h3>Distribui√ß√£o de Sa√≠das (Top 5 Meses)</h3>
            <canvas id="saidasChart" width="400" height="200" style="background: #f9f9f9; border-radius: 5px;"></canvas>
            <p style="margin-top: 15px;">**Para rodar o gr√°fico, voc√™ precisaria adicionar o c√≥digo de uma biblioteca de gr√°ficos (como o Chart.js) e escrever a fun√ß√£o `desenharGrafico()`.**</p>
        </div>
        
        <div class="card">
            <h3>Evolu√ß√£o do Saldo ao Longo do Tempo</h3>
            <canvas id="saldoChart" width="400" height="200" style="background: #f9f9f9; border-radius: 5px;"></canvas>
        </div>
    `;
    // *Aqui √© onde voc√™ chamaria uma fun√ß√£o como desenharGrafico(dadosMensais)*
}


// --- INICIALIZA√á√ÉO ---
carregarDados();

if (dados && dados.usuario && dados.usuario.nome) {
    iniciarApp();
} else {
    document.getElementById('cadastro').style.display = "block";
    document.getElementById('app').style.display = "none";
}
</script>

</body>
</html>
